import numpy as np
import pandas as pd

def sample_fragment_size(new_score, bin_edges, distributions):
    # Find which bin the new score belongs to
    bin_idx = np.digitize(new_score, bin_edges)
    # Get the probability distribution for the bin
    probabilities = distributions.loc[bin_idx].values
    discrete_values = distributions.columns.values
    # Sample a discrete number from the distribution
    return np.random.choice(discrete_values, p=probabilities)

bounds = [4.1, 8.1, 12.1, 16.1]
fragsize_prob = np.array([[7.11770964e-01, 1.53752812e-01, 1.06553153e-01, 1.95619411e-02,
        2.82028835e-03, 5.54084154e-03, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00],
       [1.20153410e-01, 4.57824749e-02, 3.31473162e-02, 2.52469754e-02,
        1.16709580e-01, 4.48883000e-01, 1.22096176e-01, 4.48883000e-02,
        2.69329800e-02, 1.61597880e-02, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00],
       [7.74508034e-02, 3.24180141e-02, 1.07572679e-02, 7.19736364e-03,
        1.01711551e-01, 2.79706766e-01, 1.27139439e-01, 7.62836633e-02,
        7.62836633e-02, 1.14425495e-01, 5.08557756e-02, 2.54278878e-02,
        1.27139439e-02, 3.81418317e-03, 2.54278878e-03, 1.27139439e-03,
        0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00],
       [4.83709778e-02, 1.47227584e-02, 3.28787372e-03, 4.42784727e-03,
        6.65155568e-02, 2.08995151e-01, 1.13997355e-01, 1.13997355e-01,
        1.04497576e-01, 1.42496694e-01, 6.64984572e-02, 4.74988980e-02,
        2.84993388e-02, 1.89995592e-02, 9.49977961e-03, 4.74988980e-03,
        2.84993388e-03, 9.49977961e-05, 0.00000000e+00, 0.00000000e+00],
       [1.77003281e-02, 2.15758183e-02, 8.85185643e-03, 3.94403048e-03,
        5.92476134e-02, 1.69235378e-01, 1.26926533e-01, 1.10002995e-01,
        8.46176888e-02, 1.52311840e-01, 1.18464764e-01, 5.92323822e-02,
        3.38470755e-02, 1.69235378e-02, 8.46176888e-03, 5.07706133e-03,
        3.38470755e-03, 1.69235378e-04, 8.46176888e-06, 1.69235378e-05]])

fragsize_prob_df = pd.DataFrame(fragsize_prob, index=[0,1,2,3,4], columns=np.arange(1,21))